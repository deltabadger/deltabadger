!!!
%html.db--application.db--loggedin{:lang => "en"}
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}
    %meta{:charset => "UTF-8"}
    %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}
    %meta{:content => "ie=edge", "http-equiv" => "X-UA-Compatible"}
    = csrf_meta_tags
    = csp_meta_tag
    
    %title Deltabadger

    %link{:href => asset_pack_path("media/images/favicon.png"), :rel => "shortcut icon", :type => "image/png"}
    = stylesheet_pack_tag 'deltabadger'

  %body
    #cookie_consent

    = render 'layouts/navbar'
    = render 'layouts/welcome_message'
    = render 'layouts/limit_reached'
    = render 'layouts/devise_messages'

    .container
      = yield

      = render 'layouts/footer'

    //= render partial: 'layouts/drift' if !Rails.env.development?

    = javascript_pack_tag 'deltabadger2'

    %script{:crossorigin => "anonymous", :integrity => "sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN", :src => "https://code.jquery.com/jquery-3.2.1.slim.min.js"}
    %script{:crossorigin => "anonymous", :integrity => "sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q", :src => "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"}
    %script{:crossorigin => "anonymous", :integrity => "sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl", :src => "https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"}

    %script{:async => "", :src => "https://www.googletagmanager.com/gtag/js?id=UA-60645901-3"}

    :javascript

      // google

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-60645901-3');

      // facebook

      window.fbAsyncInit = function() {
        FB.init({appId:"541796789740957", xfbml:!0, version:"v5.0"});
        FB.AppEvents.logPageView();
      };

      (function(a, b, c) {
        var d = a.getElementsByTagName(b)[0];
        a.getElementById(c) || (a = a.createElement(b), a.id = c, a.src = "https://connect.facebook.net/en_US/sdk.js", d.parentNode.insertBefore(a, d));
      })(document, "script", "facebook-jssdk");

      // payments plan
      $(document).ready(function(){
        $(".db-plan-investor").click(function(){
          $("#payment_plan_investor").click()
          $(".db-plan-investor").addClass("db-plan--selected")
          $(".db-plan-investor").removeClass("db-plan--other")
          $(".db-plan-hodler").addClass("db-plan--other")
          $(".db-plan-hodler").removeClass("db-plan--selected")
          $(".db-upgrade-modal").addClass("db-upgrade-modal--investor");
          $(".db-upgrade-modal").removeClass("db-upgrade-modal--hodler");
        })
        $(".db-plan-hodler").click(function(){
          $("#payment_plan_hodler").click()
          $(".db-plan-hodler").addClass("db-plan--selected")
          $(".db-plan-hodler").removeClass("db-plan--other")
          $(".db-plan-investor").addClass("db-plan--other")
          $(".db-plan-investor").removeClass("db-plan--selected")
          $(".db-upgrade-modal").addClass("db-upgrade-modal--hodler");
          $(".db-upgrade-modal").removeClass("db-upgrade-modal--investor");
        })
      })

      // payments eu/non-eu

      $(document).ready(function(){
        function setPrices(select) {
          if (!select) return;

          if (select.value.toLowerCase() === 'other') {
            $(".db-upgrade-modal").addClass("db-upgrade-modal--other");
            $(".db-upgrade-modal").removeClass("db-upgrade-modal--eu");
          } else {
            $(".db-upgrade-modal").addClass("db-upgrade-modal--eu");
            $(".db-upgrade-modal").removeClass("db-upgrade-modal--other");
          }
          var dataset = select.options[select.selectedIndex].dataset;

          $(".vat-percent").text(dataset.vp);

          $(".investor-total-price").text(dataset.itp);
          $(".investor-base-price").text(dataset.ibp);
          $(".investor-flat-discount").text(dataset.ifd);
          $(".investor-discount-percent-amount").text(dataset.idpa);
          $(".investor-total-vat").text(dataset.itv);

          $(".hodler-total-price").text(dataset.htp);
          $(".hodler-base-price").text(dataset.hbp);
          $(".hodler-flat-discount").text(dataset.hfd);
          $(".hodler-discount-percent-amount").text(dataset.hdpa);
          $(".hodler-total-vat").text(dataset.htv);
        }

        $("#payment_country").change(function(event) {
          setPrices(event.target);
        });

        setPrices(document.getElementById("payment_country"));
      });

      // referral program registration

      $(document).ready(function(){
        $(".radio--eu-company").click(function(){
          $(".db-form-group--eu-company").addClass("db-form-group--eu-company__visible");
        });
        $(".radio--private").click(function(){
          $(".db-form-group--eu-company").removeClass("db-form-group--eu-company__visible");
        });
        $(".db-form-control-range--discount-ratio").on('input', function(e){
          var discountPercent = Math.round(e.target.value * 100);
          var earnPercent = Math.round((e.target.max - e.target.value) * 100);
          $(".db-form-label-range--discount-percent").text(discountPercent);
          $(".db-form-label-range--earn-percent").text(earnPercent);
        })
        $(".db-form-control-text--visible_name").on('input', function(e){
          if (e.target.value.trim()) {
           $(".db-form-preview--visible_text").addClass("db-form-preview--visible_text__visible");
          } else {
           $(".db-form-preview--visible_text").removeClass("db-form-preview--visible_text__visible");
          }
          $(".db-form-preview--visible_name").text(e.target.value);
        })
       });
