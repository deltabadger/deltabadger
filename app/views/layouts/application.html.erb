<!DOCTYPE html>
<html lang="<%= I18n.locale %>" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <meta name="color-scheme" content="dark light">
    <meta name="theme-color" content="#f5f6f8" id="theme-color-meta">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= canonical_url_for_static_page if content_for?(:static_page) %>
    <meta name="description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : t('meta.descriptions.default') %>">

    <title><%= content_for?(:title) ? yield(:title) : t('meta.title') %></title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <%= render 'application/favicon' %>

    <%= stylesheet_link_tag 'application', media: 'all', "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>

    <%= yield :head if content_for?(:head) %>

    <script>
      // service worker registration for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register("/service-worker.js").then(function(registration) {
          // console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }).catch(function(error) {
          console.log('ServiceWorker registration failed: ', error);
        });
      }
    </script>

    <script>
      (async () => {
        if (window.__IS_TAURI__) {
          document.documentElement.classList.add('tauri');

          const { getCurrentWindow } = await import('@tauri-apps/api/window');
          const appWindow = getCurrentWindow();
          
          const dragRegion = document.querySelector('.titlebar-drag-region');
          if (dragRegion) {
            dragRegion.addEventListener('mousedown', async (e) => {
              if (e.buttons === 1) {
                await appWindow.startDragging();
              }
            });
          }
        }
      })();
    </script>
    
  </head>

  <body data-controller="hotwire-animations app-wake" data-locale="<%= I18n.locale %>" class="<%= yield(:body_class) %> <%= main_body_classes %>">

    <div data-tauri-drag-region class="titlebar-drag-region"></div>

    <div id="flash">
      <%= render 'layouts/flash' %>
    </div>

    <%= render 'layouts/navbar' %>

    <div class="main">
      <div class="main-content">
        <%= yield %>
      </div>
    </div>

    <%= turbo_frame_tag 'modal' %>

  </body>
</html>