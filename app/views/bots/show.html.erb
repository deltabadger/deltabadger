<%= turbo_stream_from "user_#{current_user.id}", :bot_updates %>

<%= turbo_frame_tag "bot", data: { controller: "perform-on-page-load",
                                   perform_on_page_load_channel_value: "BotUpdatesChannel",
                                   perform_on_page_load_method_value: "broadcast_metrics_update",
                                   perform_on_page_load_method_args_value: { bot_id: @bot.id }.to_json } do %>
  <div class="page-head">
    <%= render "bots/header", bot: @bot, other_bots: @other_bots %>
  </div>
  <div class="flex-column gap-1">
    <div class="bot-control">
      <%= render partial: "bots/exchange_select", locals: { bot: @bot } %>
      <%= render "bots/status/status_bar", bot: @bot %>
      <%= render "bots/status/status_button", bot: @bot %>
    </div>
    <div class="columns">
      <div class="column gap-1">
        <%= render partial: "bots/description", locals: { bot: @bot } %>
        <%= render partial: "bots/settings", locals: { bot: @bot } %>
        <%= render partial: "bots/settings_extra", locals: { bot: @bot } %>
        <%# render partial: "bots/settings_extra_weekday", locals: { bot: @bot } %>
        <%# render partial: "bots/settings_extra_time_limit", locals: { bot: @bot } %>
        <%# render partial: "bots/settings_extra_price_limit", locals: { bot: @bot } %>
      </div>
      <div class="column gap-1">
        <%= render partial: "bots/chart", locals: { bot: @bot, metrics: @metrics, loading: true } %>
        <%= render partial: "bots/metrics/metrics", locals: { bot: @bot, metrics: @metrics, loading: true } %>
        <%= render partial: "bots/orders/orders", locals: { bot: @bot, decimals: @decimals } %>
      </div>
    </div>
  </div>
<% end %>
