<%= turbo_stream_from "user_#{current_user.id}", :bot_updates %>


  <section class="dash-intro">
    <%= render partial: 'bots/global_pnl', locals: { global_pnl: @global_pnl, loading: @loading_hash.values.any? } %>
  </section>

<% if @bots.empty? %>
  <%= render partial: 'bots/new_menu_start' %>
<% else %>
  <div class="page-head page-head--dashboard">
    <div class="filters">
      <% if @show_filters %>
        <%= link_to t('bot_filters.all'), bots_path(filter: 'all'), class: ["sbutton sbutton--multi", ("sbutton--multi--active" if @filter == 'all')] %>
        <%= link_to t('bot_filters.active'), bots_path(filter: 'active'), class: ["sbutton sbutton--multi", ("sbutton--multi--active" if @filter == 'active')] %>
        <%= link_to t('bot_filters.inactive'), bots_path(filter: 'inactive'), class: ["sbutton sbutton--multi", ("sbutton--multi--active" if @filter == 'inactive')] %>
      <% end %>
    </div>

    <div>
      <%= button_to new_bot_path, method: :get, class: "sbutton sbutton--sky", data: { turbo_frame: "modal" } do %>
        <span class="d-none d-sm-inline"><%= t('bot.new') %></span>
        <%= render partial: 'svg/24x24_plus' %>
      <% end %>
    </div>
  </div>

  <% ids_to_load = @loading_hash.select { |_, loading| loading }.keys %>
  <%= tag.div class: 'itiles', data: ids_to_load.any? ? { controller: "broadcast--on-connect",
                                                          broadcast__on_connect_method_value: "pnl_update",
                                                          broadcast__on_connect_method_args_value: {    bot_ids: ids_to_load }.to_json } : {} do %>
    <%= render partial: 'bots/bot_tile/bot_tile', collection: @bots, as: :bot, locals: { pnl_hash: @pnl_hash, loading_hash: @loading_hash } %>
  <% end %>
<% end %>
