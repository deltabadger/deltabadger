<%= form_with model: bot,
              url: bot.new_record? ? barbell_new_step_confirm_bots_path : bot_path(bot),
              method: bot.new_record? ? :get : :patch,
              id: "settings-amount-limit",
              class: "widget",
              data: { controller: "form--submit form--html5-validations" } do |f| %>
  <% if bot.new_record? %>
    <%= f.hidden_field :label, value: bot.label %>
    <%= f.hidden_field :base0_asset_id, value: bot.base0_asset_id %>
    <%= f.hidden_field :base1_asset_id, value: bot.base1_asset_id %>
    <%= f.hidden_field :quote_asset_id, value: bot.quote_asset_id %>
    <%= f.hidden_field :exchange_id, value: bot.exchange_id %>
    <%= f.hidden_field :quote_amount, value: bot.quote_amount %>
    <%= f.hidden_field :interval, value: bot.interval %>
    <%= f.hidden_field :allocation0, value: bot.allocation0 %>
    <%= f.hidden_field :marketcap_allocated, value: bot.marketcap_allocated %>
  <% end %>
  <div class="toggle-group">
    <div class="toggle">
      <%= f.check_box :quote_amount_limited, data: { action: "change->form--submit#submit" }, disabled: bot.quote_amount.blank? || bot.working? %>
      <div class="toggle__style"></div>
      <%= f.label :quote_amount_limited, class: "conversational conversational--small conversational--disabled" do %>
        <%= t("bot.settings.extra_amount_limit.dont_spend_more_than") %>
        <div>
          <%= f.number_field :quote_amount_limit, value: bot.quote_amount_limit.to_d.to_s('F').sub(/^(?!0\.0$)([1-9]\d*)\.0$/, '\1'), class: 'sinput numeric-input', min: [bot.ticker0.minimum_quote_size, bot.ticker1.minimum_quote_size].max, step: :any, size: 3, data: { controller: "autowidth-input", action: "change->form--submit#submit input->autowidth-input#resize" }, style: "margin-left: 0.125rem; width: 50px;", disabled: bot.working? %>
          <%= bot.quote_asset.symbol %>
        </div>
        <%= render partial: "bots/barbell/settings/amount_limit_info", locals: { bot: bot } %>
      <% end %>
    </div>
  </div>
<% end %>
