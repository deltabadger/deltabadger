<%= turbo_frame_tag "asset-picker", data: { action: "keydown@window->arrow-keys-navigation#navigate", controller: "arrow-keys-navigation" }, class: "modal--search__assets" do %>

  <%# FIXME: test spinner. %>
  <% if assets.blank? %>
    <%# This is just a placeholder to design the style, however it's shown even if no text is input in the form. To solve it I have to enable background tasks, that process the search and broadcast the results once ready. %>
    <div class="loader"></div>
  <% end %>

  <% assets.each_with_index do |asset, index| %>
    <%= form_with model: bot, url: next_step_path, method: :get, data: { arrow_keys_navigation_target: "item" }, class: "modal--search__assets__item" do |f| %>
      <%= f.hidden_field :label, value: bot.label %>
      <%= f.hidden_field asset_field, value: asset.id %>
      <%= f.hidden_field :base0_asset_id, value: bot.base0_asset_id if asset_field != :base0_asset_id %>
      <%= f.hidden_field :base1_asset_id, value: bot.base1_asset_id if asset_field != :base1_asset_id %>
      <%= f.hidden_field :quote_asset_id, value: bot.quote_asset_id if asset_field != :quote_asset_id %>
      <%= f.hidden_field :exchange_id, value: bot.exchange_id %>
      <%= button_tag type: :submit, data: { arrow_keys_navigation_target: "button", turbo_frame: "modal_content" } do %>
        <div class="modal--search__cell modal--search__cell--ticker"><%= asset.symbol %></div>
        <div class="modal--search__cell modal--search__cell--name">
          <%= asset.name %>
        </div>
        <div class="modal--search__cell modal--search__cell--exchanges">
                <%= asset.exchanges.map do |exchange| 
                  exchange_name = exchange.name.downcase
                  exchange_name = case exchange_name
                                  when 'binance.us' then 'binance'
                                  else exchange_name
                                  end
                  render "svg/exchange-#{exchange_name}", title: exchange.name
                end.join(' ').html_safe %>
              </div>
      <% end %>
    <% end %>
  <% end %>

<% end %>