<% content_for :title, t('articles.index.title') %>
<% content_for :meta_description, t('articles.index.meta_description') %>

<% content_for :head do %>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400..700&family=Inter+Tight:ital,wght@0,100..900;1,100..900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="<%= t('articles.index.title') %>">
  <meta property="og:description" content="<%= t('articles.index.meta_description') %>">
  <meta property="og:url" content="<%= articles_url %>">
  <meta property="og:site_name" content="Deltabadger Research">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= t('articles.index.title') %>">
  <meta name="twitter:description" content="<%= t('articles.index.meta_description') %>">
<% end %>

<hgroup class="articles-header">
  <h1 class="articles-header__title"><%= render partial: 'svg/40x159_research', locals: { title: t('articles.index.title') } %></h1>
  <p class="articles-header__subtitle"><%= t('articles.index.meta_description') %></p>
  <% unless current_user&.subscription&.research? %>
    <% path = current_user.present? ? upgrade_path : new_user_registration_path %>
    <%= link_to path, class: "premium-subscribers-button" do %>
      <%= render partial: 'articles/premium_subscribers', locals: { count: @premium_subscribers_count } %> â†’
    <% end %>
  <% end %>
</hgroup>

<% if @articles.any? %>
  <div class="articles">
    <% @articles.each do |article| %>
      <%= link_to article_path(article), class: "article-card", data: { turbo: false } do %>
        <% if article.thumbnail_path.present? %>
          <% jpg_thumbnail = article.thumbnail_path.gsub(/\.[^.]+$/, '.jpg') %>
          <%= image_tag jpg_thumbnail, alt: article.plain_title, class: "article-card__thumbnail" %>
        <% end %>

        <div class="article-card__content">
          <h2 class="article-card__title">
            <%= article.title.html_safe %>
          </h2>

          <div class="article-card__meta">
            <% if article.author.present? %>
              <span class="article-card__meta__author"><%= article.author.name %></span>
            <% end %>

            <% if article.published_at.present? %>
              &middot;
              <time class="article-card__meta__date" datetime="<%= article.published_at.iso8601 %>">
                <%= l(article.published_at.to_date, format: :long) %>
              </time>
            <% end %>

            <% if article.reading_time_minutes.present? %>
              &middot;
              <span class="article-card__meta__reading-time">
                <%= t('articles.reading_time', minutes: article.reading_time_minutes) %>
              </span>
            <% end %>

            <% if article.paywalled? %>
              &middot;
              <span class="article__header__meta__premium">
                <%= t('articles.premium_content') %>
              </span>
            <% end %>

          </div>

          <div class="article-excerpt">
            <%= article.excerpt %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
<% else %>
  <div class="no-articles">
    <p><%= t('articles.index.no_articles') %></p>
  </div>
<% end %>