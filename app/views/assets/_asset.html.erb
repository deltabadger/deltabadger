<% id_prefix = asset.portfolio.active_assets.map(&:id).include?(asset.id) ? 'active' : 'idle' %>
<%= tag.div id: "#{id_prefix}_#{dom_id(asset)}" do %>
  <% asset_color = asset.color || "#F7931A" %>
  <%= tag.div class: "basket__asset",
              data: {
                hw_animate_in_append: "animate-asset-in",
                hw_animate_in_after: "animate-asset-in",
                hw_animate_out_remove: "animate-asset-out"
  } do %>
    <%= form_with model: asset, url: portfolio_asset_path(asset.portfolio_id, asset), method: :patch, html: { class: "basket__asset__form", onchange: "requestSubmit();" }, data: { controller: "portfolio-analyzer--asset-allocation", portfolio_analyzer__asset_allocation_asset_api_id_value: asset.api_id } do |form| %>
      <div class="ticker-input ticker-input--percentage" title="<%= asset.name %>">
        <%= form.text_field :allocation_input_text, value: (asset.allocation * 100).round(0), data: { portfolio_analyzer__asset_allocation_target: "allocationInputText", action: "change->portfolio-analyzer--asset-allocation#updateAssetAllocation" }, disabled: asset.portfolio.smart_allocation_on?, class: "numeric-input iu-numeric iu-char-limit" %>
        <span>%</span>
        <%= tag.div class: "ticker", style: "background: #{asset_color}; color: #{ensure_contrast(asset_color, 1.5)};" do %>
          <%= asset.ticker %>
        <% end %>
      </div>
      <div class="slider">
        <%= form.range_field :allocation, in: 0.0..1.0, step: 0.01, value: asset.allocation, class: "slider__input", data: { portfolio_analyzer__asset_allocation_target: "allocation", action: "input->portfolio-analyzer--asset-allocation#updateAssetAllocation" }, disabled: asset.portfolio.smart_allocation_on? %>
        <div class="slider__style">
          <%= tag.div class: "slider__style__track", style: "border-left-color: #{asset_color};" do %>
            <%= tag.div class: "slider__style__progress", style: "width: #{asset.allocation * 100}%; background: #{asset_color};", data: { portfolio_analyzer__asset_allocation_target: "allocationSlider" } do %>
              <%= tag.div class: "slider__style__thumb", style: "background: #{asset_color};" do %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
      <%# <input type="text" class="numeric-input iu-numeric iu-autowidth" style="width:40rem" size="1" placeholder="0.123">  %>
    <% end %>
    <%= button_to portfolio_asset_path(asset.portfolio_id, asset), method: :delete, class: "basket__remove__icon icon-20", style: "background: none; border: none; padding: 0;" do %>
      <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5.5 5.5L10.5 10.5M5.5 10.5L10.5 5.5" stroke="#8894B6" stroke-width="1.5" stroke-linecap="square"></path>
      </svg>
    <% end %>
  <% end %>
<% end %>