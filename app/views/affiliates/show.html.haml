- unless affiliate_active
  .alert.alert-secondary.db-alert--flex
    %span= t('.deactivated.notice')

    %a.btn.btn-outline-secondary{href: "mailto:contact@deltabadger.com"}
      %span= t('.deactivated.contact')

- if affiliate_active && !unlimited_active
  .alert.alert-primary.db-alert--flex
    %span= t('.expired')

    %a.btn.btn-primary{href: upgrade_path}
      %span= t('subscriptions.upgrade')

.container.db-page
  .row.mt-5
    .col-md-5
      %h1.mb-5= t('subscriptions.upgrade')
      .db-referral-stats
        - stats = Presenters::Affiliates::ReferrerStats.new(affiliate)
        .db-referral-stats__item
          .db-referral-stats__item__title
            = t('.referees')
          .db-referral-stats__item__number
            = stats.referee_count
        .db-referral-stats__item
          .db-referral-stats__item__title
            = stats.unpaid_commission
          .db-referral-stats__item__number
            = stats.unpaid_commission
        .db-referral-stats__item
          .db-referral-stats__item__title
            = stats.paid_commission
          .db-referral-stats__item__number
            = stats.paid_commission
    .col-md-7{ class: ("db-referral-program-registration--inactive" if disabled) }
      .alert.alert-success.pb-4
        = t('affiliates.manual_html')

      .db-settings-section
        .db-form__row.db-form__row--input
          %input.db-form__input{ :type=>"text", :value=>ref_code_url(code: affiliate.code), :readonly=>"readonly" }
          %label.db-form__label= t('.your_link')

      .db-settings-section
        %h4.db-modal__subtitle Update visible info
        .mb-5
          - presenter = Presenters::RefCodes::Show.new(affiliate)

          %p= t('.info_preview')
          = render partial: 'ref_codes/show', locals: { affiliate: affiliate }

        = form_with model: affiliate, method: :patch, local: true, url: update_visible_info_affiliate_path do |f|
          .db-form__row.db-form__row--input
            = f.text_field :visible_name, class: 'db-form__input', disabled: disabled
            = f.label :visible_name, class: 'db-form__label'

          .db-form__row.db-form__row--input

          .db-form__row.db-form__row--input
            = f.select :visible_link_scheme, [['https://', 'https'], ['http://', 'http']], {}, class: 'form-control form-control-lg db-http-prefix-select'
            = f.text_field :visible_link, class: 'db-form__input', disabled: disabled
            = f.label :visible_link

          .db-form__row.db-form__row--final-button
            = f.submit t('.submit_info'), class: 'btn btn-lg btn-primary', disabled: disabled

      .db-settings-section
        %h4.db-modal__subtitle= t('.update_bitcoin_address')
        - if errors.present?
          %ul.pl-3
            - errors.each do |error|
              %li.text-danger= error

        = form_with model: affiliate, method: :patch, local: true, url: update_btc_address_affiliate_path do |f|
          .form-group
            = f.label :btc_address
            = f.text_field :btc_address, class: 'form-control form-control-lg', disabled: disabled
          .form-group.mb-5
            = f.label :current_password, t('helpers.label.user.current_password') + ' ' + t('forms.for_confirmation')
            = f.password_field :current_password, autocomplete: 'off', class: 'form-control form-control-lg', disabled: disabled
          .form-group.text-center
            = f.submit t('.submit_bitcoin_address'), class: 'btn btn-lg btn-primary', disabled: disabled
