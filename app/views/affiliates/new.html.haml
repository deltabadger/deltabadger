- disabled = !current_user.unlimited?

- if disabled
  .alert.alert-primary.db-alert--flex
    %span= t('.upgrade')

    %a.btn.btn-primary{href: upgrade_path}
      %span= t('subscriptions.upgrade')

.row.pt-5
  .col-sm-12.col-lg-6
    %h2= t('.title')
    .alert.alert-success.mt-5
      = t('affiliates.manual_html')
  .col-sm-12.col-lg-6
    .db-referral-program-registration{ class: ("db-referral-program-registration--inactive" if disabled) }
      - if errors.present?
        %ul.pl-3
          - errors.each do |error|
            %li.text-danger= error

      = form_with model: affiliate, local: true, url: affiliate_path do |f|
        .db-box.mb-1
          %h4.mb-4
            %span.db-number 1
            = t('.referrer_info')
          -# change to referer from referer info

          - presenter = Presenters::Affiliates::New.new(affiliate)

          .form-group.mb-0
            .form-check.form-check-inline
              = f.radio_button :type, "individual", checked: presenter.individual?, class: "mr-2 radio--private", disabled: disabled
              = f.label :type, t('.private'), value: "individual", class: "form-check-label"
            .form-check.form-check-inline
              = f.radio_button :type, "eu_company", checked: !presenter.individual?, class: "mr-2 radio--eu-company", disabled: disabled
              = f.label :type, t('.eu_company'), value: "eu_company", class: "form-check-label"

          .db-form__row.db-form__row--input.db-form-group--eu-company.mt-4{ class: ("db-form-group--eu-company__visible" unless presenter.individual?) }
            = f.text_field :name, disabled: disabled, type: 'text', autocomplete: 'nope', value: "", class: "db-form__input", onchange: 'this.setAttribute("value", this.value);'
            = f.label :name, "Name of the company", class: "db-form__label"

          .db-form__row.db-form__row--input.db-form-group--eu-company{ class: ("db-form-group--eu-company__visible" unless presenter.individual?) }
            = f.text_field :address, disabled: disabled, type: 'text', autocomplete: 'nope', value: "", class: "db-form__input", onchange: 'this.setAttribute("value", this.value);'
            = f.label :address, "Address of the company", class: "db-form__label"

          .db-form__row.db-form__row--input.db-form-group--eu-company.mb-0{ class: ("db-form-group--eu-company__visible" unless presenter.individual?) }
            = f.text_field :vat_number, disabled: disabled, pattern: '^(ATU[0-9]{8}|BE0[0-9]{9}|BG[0-9]{9,10}|CY[0-9]{8}L|CZ[0-9]{8,10}|DE[0-9]{9}|DK[0-9]{8}|EE[0-9]{9}|(EL|GR)[0-9]{9}|ES[0-9A-Z][0-9]{7}[0-9A-Z]|FI[0-9]{8}|FR[0-9A-Z]{2}[0-9]{9}|GB([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3})|HU[0-9]{8}|IE[0-9]S[0-9]{5}L|IT[0-9]{11}|LT([0-9]{9}|[0-9]{12})|LU[0-9]{8}|LV[0-9]{11}|MT[0-9]{8}|NL[0-9]{9}B[0-9]{2}|PL[0-9]{10}|PT[0-9]{9}|RO[0-9]{2,10}|SE[0-9]{12}|SI[0-9]{8}|SK[0-9]{10})$', type: 'text', autocomplete: 'nope', value: "", class: "db-form__input", onchange: 'this.setAttribute("value", this.value);'
            .db-form__info.db-form__info--invalid
              =t('subscriptions.payment.invalid_vat_number')
            = f.label :vat_number, "VAT number (optional)", class: "db-form__label"

        .db-box.mb-1
          %h4.pb-3
            %span.db-number 2
            = t('.payout_address')

          .db-form__row.db-form__row--input.mb-0
            = f.text_field :btc_address, disabled: disabled, pattern: '^([13][a-km-zA-HJ-NP-Z1-9]{25,34}|bc1[ac-hj-np-zAC-HJ-NP-Z02-9]{11,71})$', type: 'text', autocomplete: 'nope', value: "", class: "db-form__input", onchange: 'this.setAttribute("value", this.value);'
            .db-form__info.db-form__info--invalid
              #{t('affiliates.invalid_bitcoin_address')}
            = f.label :btc_address, t('affiliates.your_bitcoin_address'), class: "db-form__label"

        .db-box.mb-1
          %h4.pb-3
            %span.db-number 3
            = t('.program_settings_html')

          .db-form__row.db-form__row--input.db-form__row--input--referralcode
            = f.text_field :code, id: 'referral-code', disabled: disabled, type: 'text', autocomplete: 'nope', value: "", class: "db-form__input", onchange: 'this.setAttribute("value", this.value);'
            .db-referral-prefix= "deltabadger.com/ref/"
            = f.label :code, t('.pick_referral_code'), class: "db-form__label"

          .form-group.mb-0
            = f.label :discount_percent do
              = t('.discount_info_html', earn_percent_preview: presenter.earn_percent_preview, discount_percent_preview: presenter.discount_percent_preview)
            = f.range_field :discount_percent, in: (presenter.min_discount_percent)..(presenter.max_discount_percent), value: presenter.discount_percent, step: presenter.percent_step, data: { sum: presenter.bonus_percent }, class: "db-form-control-range--discount-ratio form-control-range", style: "direction: rtl", disabled: disabled

        .db-box.mb-1
          %h4.pb-3
            %span.db-number 4
            = t('.visible_info')

          %p #{t('affiliates.info_preview')}
          %table.table.db-table--checkout
            %tbody.table-borderless
              %tr
                %td.text-success.pr-0.pl-0(scope="col")
                  <i class="material-icons-round">check_circle</i>
                %td(scope="col")
                  %b.text-success #{t('.discount_preview_html', discount_percent_preview: presenter.discount_percent_preview)}
                  %span.db-billing-item__info
                    %span.db-form-preview--visible_text{class: ('db-form-preview--visible_text__visible' if affiliate.visible_name.present?)}
                      = t('.thanks_referral')
                      %b
                        %a{href: 'javascript:;'} <span class='db-form-preview--visible_name'>#{affiliate.visible_name}</span>

          %p.mb-3 #{t('affiliates.add_link_info')}

          .db-form__row.db-form__row--input
            = f.text_field :visible_name, disabled: disabled, type: 'text', value: "", class: "db-form__input db-form-control-text--visible_name", onchange: 'this.setAttribute("value", this.value);'
            = f.label :visible_name, t('helpers.label.affiliate.visible_name'), class: "db-form__label"

          .db-form__row.db-form__row--input.db-form__row--input--has-http-select

            = f.text_field :visible_link, disabled: disabled, type: 'text', autocomplete: 'nope', class: "db-form__input", onchange: 'this.setAttribute("value", this.value);'
            = f.select :visible_link_scheme, [['//:https', 'https'], ['//:http', 'http']], {}, disabled: disabled, class: "db-form__input--http  db-http-prefix-select", dir: "rtl"
            = f.label :visible_link, t('helpers.label.affiliate.visible_link'), class: "db-form__label"

          - unless disabled
            .form-check.pt-2.pb-4.text-center
              = f.check_box :check, class: "form-check-input"
              = f.label :check, t('.checked'), class: "form-check-label"

          - if disabled
            .db-form__row.db-form__row--final-button
              %button.btn.btn-success.btn-lg{type: 'submit', disabled: true}
                = t('.submit')
          - else
            .db-form__row.db-form__row--final-button
              %button.btn.btn-success.btn-lg{type: 'submit'}
                = t('.submit')
