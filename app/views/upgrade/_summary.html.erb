<div class="pricing__checkout__calculations widget widget--single">

  <div class="checkout-line checkout-line--base-price">
    <div class="checkout-line__col">
      <div class="checkout-line__name">
      Base price
        <% if payment.subscription_plan_variant.years.present? && payment.subscription_plan_variant.years != 1 %>
          <%= payment.subscription_plan_variant.years %>
          x
          <%= localized_price(payment.virtual_price('base_price', 1.year), payment.currency, true) %>
        <% end %>
      </div>
    </div>
    <div class="checkout-line__col">
      <%= localized_price(payment.base_price, payment.currency) %>
    </div>
  </div>

  <% if current_user.subscription.days_left.present? %>
    <div class="checkout-line checkout-line--discount">
      <div class="checkout-line__col">
        <div class="checkout-line__name"><%= t('subscriptions.payment.active_plan_discount') %></div>
        <div class=""><%= t("subscriptions.payment.compensation_#{current_user.subscription.name}", count: current_user.subscription.days_left) %></div>
      </div>
      <div class="checkout-line__col">
        -<%= localized_price(payment.current_plan_discount_amount, payment.currency, true) %>
      </div>
    </div>
  <% end %>

  <% if current_user.eligible_referrer.present? %>
    <% discount_presenter = RefCodesPresenter.new(current_user.eligible_referrer) %>
    <div class="checkout-line checkout-line--discount">
      <div class="checkout-line__col">
        <div class="checkout-line__name"><%= t('subscriptions.payment.referral_discount', discount_percent: format_percent(current_user.eligible_referrer.discount_percent)) %></div>
        <div class="">
          <% if discount_presenter.info? %>
            <%= t('subscriptions.payment.referral_discount_html', visible_link: discount_presenter.visible_path, visible_name: discount_presenter.visible_name) %>
          <% end %>
        </div>
      </div>
      <div class="checkout-line__col">
        -<%= localized_price(payment.referral_discount_amount, payment.currency, true) %>
      </div>
    </div>
  <% end %>

  <% unless payment.black_friday_discount_amount.zero? %>
    <div class="checkout-line checkout-line--discount">
      <div class="checkout-line__col">
        <div class="checkout-line__name" style="margin-bottom: 0">Black Friday</div>
        <!-- <div class=""><%= format_percent(payment.black_friday_discount_percent) %> OFF</div> -->
      </div>
      <div class="checkout-line__col">
        -<%= localized_price(payment.black_friday_discount_amount, payment.currency, true) %>
      </div>
    </div>
  <% end %>

  <% unless payment.vat_percent.zero? %>
    <div class="checkout-line checkout-line--vat">
      <div class="checkout-line__col">
        <%= t('subscriptions.payment.vat') %> <%= format_percent(payment.vat_percent) %>
      </div>
      <div class="checkout-line__col">
        <%= tag.span class: "#{payment.subscription_plan.name}-total-vat" do %>
          <%= localized_price(payment.vat_amount, payment.currency, 2) %>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="checkout-line checkout-line--summary">
    <div class="checkout-line__col">
      <%= t('subscriptions.payment.you_pay') %>
    </div>
    <div class="checkout-line__col">
      <%= tag.span class: "#{payment.subscription_plan.name}" do %>
        <%= localized_price(payment.price_with_vat, payment.currency, true) %>
      <% end %>
    </div>
  </div>
</div>

<% if payment.subscription_plan.name == legendary_plan.name %>
  <div class="widget widget--single widget--legendary-plans">
    <span>
      <%= t('subscriptions.payment.legendary_plan_discount_html', amount: localized_price(10, payment.currency, true)) %>
    </span>
    <div class="widget--pricing__legendary-plans-left">
      <span><%= t('subscriptions.legendary_plan_left', for_sale_count: legendary_plan.for_sale_count, total_supply: legendary_plan.total_supply) %></span>
      <div class="slider">
        <div class="slider__style">
          <div class="slider__style__track">
            <div class="slider__style__progress" role="progressbar" style="width: <%= legendary_plan.sold_percent %>%" aria-valuenow="<%= legendary_plan.sold_percent %>" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

