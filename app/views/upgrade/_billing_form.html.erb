<% pending_wire_transfer = !current_user.pending_wire_transfer.nil? %>

<div class="modal-dialog m-0 <%= 'db-wire-transfer-in-progress' if pending_wire_transfer %>" style="max-width: 100%">
  <div class="modal-content">
    <div class="modal-body">
      <% unless pending_wire_transfer %>
        <%= form_with url: upgrade_path, method: :get, data: { controller: "form--submit", turbo_frame: "billing-form-frame" } do |f| %>
            <% if SettingFlag.show_zen_payment? %>
              <%= tag.label class: "hide_radio_buttons nav-item" do %>
                <%= f.radio_button :payment_type, 'zen', checked: payment.by_zen?, data: { action: "change->form--submit#submit" } %>
                <div class="db-card-providers">
                  <img src="<%= asset_pack_path("media/images/mastercard.svg") %>" alt="" class="db-card-providers__item db-card-providers__item--mastercard">
                  <img src="<%= asset_pack_path("media/images/visa.svg") %>" alt="" class="db-card-providers__item db-card-providers__item--visa">
                </div>
              <% end %>
            <% end %>
            <% if SettingFlag.show_bitcoin_payment? %>
              <%= tag.label class: "hide_radio_buttons nav-item" do %>
                <%= f.radio_button :payment_type, 'bitcoin', checked: payment.by_bitcoin?, data: { action: "change->form--submit#submit" } %>
                <div class="db-card-providers">
                  <img src="<%= asset_pack_path("media/images/bitcoin.svg") %>" alt="" class="db-card-providers__item db-card-providers__item--bitcoin">
                </div>
              <% end %>
            <% end %>
            <% if SettingFlag.show_wire_payment? %>
              <%= tag.label class: "hide_radio_buttons nav-item" do %>
                <%= f.radio_button :payment_type, 'wire', checked: payment.by_wire?, data: { action: "change->form--submit#submit" } %>
                <%= t('subscriptions.payment.wire_transfer') %>
              <% end %>
            <% end %>
        <% end %>
      <% end %>

      <%= turbo_frame_tag "billing-form-frame" do %>
        <%= tag.div id: "payTabContent", class: "tab-content", data: {
          controller: "zaraz",
          zaraz_currency_value: payment.country,
          zaraz_name_value: plan_variant_name(payment.subscription_plan_variant),
          zaraz_price_value: payment.price_with_vat
        } do %>
          <div id="payZen" class="tab-pane <%= pending_wire_transfer ? 'disabled' : ( 'active' if payment.by_zen?) %>" aria-labelledby="log-tab" role="tabpanel">
            <%= render partial: "country_form", locals: { payment: payment } %>
            <%= form_with model: payment, url: upgrade_path do |f| %>
              <div class="db-form__row db-form__row--final-button">
                <%= f.submit data: { turbo: false, action: "click->zaraz#trackBeginCheckoutEvent", zaraz_target: "button" }, class: "btn btn-success btn-lg w-100", disabled: payment.price_with_vat == 0 do %>
                  <span class="mr-3"><%= t('subscriptions.payment.pay') %></span>
                  <%= tag.span class: "#{payment.subscription_plan.name}-total-price" do %>
                    <%= format_price(payment.price_with_vat, payment.currency) %>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>

          <div id="payBitcoin" class="tab-pane <%= pending_wire_transfer ? 'disabled' : ( 'active' if payment.by_bitcoin?) %>" aria-labelledby="log-tab" role="tabpanel">
            <%= render partial: "country_form", locals: { payment: payment } %>
            <%= form_with model: payment, url: upgrade_path, data: { controller: "form--html5-validations" } do |f| %>
              <div class="db-form__row">
                <%= f.text_field :first_name, class: 'db-form__input', autocomplete: "given-name", required: true %>
                <%= f.label :first_name, class: 'db-form__label' %>
              </div>
              <div class="db-form__row">
                <%= f.text_field :last_name, class: 'db-form__input', autocomplete: "family-name", required: true %>
                <%= f.label :last_name, class: 'db-form__label' %>
              </div>
              <div class="db-form__row">
                <%= f.date_field :birth_date, autocomplete: "bday", class: 'db-form__input db-form__input--date', required: true %>
                <%= f.label :birth_date, class: 'db-form__label' %>
              </div>
              <div class="db-form__row db-form__row--final-button">
                <%= f.submit data: { turbo: false, action: "click->zaraz#trackBeginCheckoutEvent", zaraz_target: "button" }, class: "btn btn-success btn-lg w-100", disabled: payment.price_with_vat == 0 do %>
                  <span class="mr-0"><%= t('subscriptions.payment.pay_with_bitcoin') %></span>
                <% end %>
              </div>
            <% end %>
          </div>

          <div id="payWire" class="tab-pane <%= 'active' if pending_wire_transfer || payment.by_wire? %>" aria-labelledby="log-tab" role="tabpanel">
            <% unless pending_wire_transfer %>
              <%= render partial: "country_form", locals: { payment: payment } %>
            <% end %>
            <%= form_with model: payment, url: upgrade_path, id: "new_payment", class: "new_payment", data: { controller: "form--html5-validations" } do |f| %>
              <% if pending_wire_transfer %>
                <div class="db-form__row"><%= t('subscriptions.payment.wire_transfer_pending') %></div>
                <div class="db-form__row">
                  <%= t('subscriptions.payment.wire_cost_pending_html', price: format_price(payment.price_with_vat, payment.currency)) %>
                </div>
              <% else %>
                <div class="db-form__row">
                  <%= f.text_field :first_name, class: 'db-form__input', autocomplete: "given-name", required: true %>
                  <%= f.label :first_name, class: 'db-form__label' %>
                </div>
                <div class="db-form__row">
                  <%= f.text_field :last_name, class: 'db-form__input', autocomplete: "family-name", required: true %>
                  <%= f.label :last_name, class: 'db-form__label' %>
                </div>
                <div id="wire_costs" class="db-form__row--hidden">
                  <%= t('subscriptions.payment.wire_cost_html', price: format_price(payment.price_with_vat, payment.currency)) %>
                </div>
              <% end %>
              <% if payment.from_eu? %>
                <div>
                  <h5 class="mt-5"><%= t('subscriptions.payment.account_holder') %></h5>
                  <p>Deltabadger OU</p>
                  <h5>BIC</h5>
                  <p>TRWIBEB1XXX</p>
                  <h5><%= "IBAN (" + t('subscriptions.payment.eu_bank_country') + ")" %></h5>
                  <p>BE83 9670 6500 4615</p>
                  <h5><%= t('subscriptions.payment.bank_address') %></h5>
                  <p>
                    Avenue Louise 54, Room S52<br>
                    Brussels<br>
                    1050<br>
                    Belgium
                  </p>
                </div>
              <% else %>
                <div>
                  <h5 class="mt-5"><%= t('subscriptions.payment.account_holder') %></h5>
                  <p>Deltabadger OU</p>
                  <h5>Routing number</h5>
                  <p>084009519</p>
                  <h5>Account number</h5>
                  <p>9600 0000 0051 1836</p>
                  <h5>Account type</h5>
                  <p>Checking</p>
                  <h5><%= t('subscriptions.payment.bank_address') %></h5>
                  <p>
                    TransferWise<br>
                    19 W 24th Street<br>
                    New York NY 10010<br>
                    United States
                  </p>
                </div>
              <% end %>
              <% unless pending_wire_transfer %>
                <div class="db-form__row db-form__row--final-button">
                  <%= f.submit data: { action: "click->zaraz#trackBeginCheckoutEvent", zaraz_target: "button" }, class: "btn btn-success btn-lg w-100", disabled: payment.price_with_vat == 0 do %>
                    <span class="mr-0">
                      <%= payment.from_eu? ?
                        t('subscriptions.payment.paid_with_wire_transfer') :
                        t('subscriptions.payment.paid_with_wire_transfer_other')
                      %>
                    </span>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>